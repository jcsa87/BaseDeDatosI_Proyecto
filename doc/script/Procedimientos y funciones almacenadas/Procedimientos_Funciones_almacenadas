CAP√çTULO I: INTRODUCCI√ìN
a. Tema

Este trabajo tiene como tema central el estudio de los procedimientos almacenados y las funciones definidas por el usuario en SQL Server, herramientas esenciales para la automatizaci√≥n, optimizaci√≥n y estructuraci√≥n de la l√≥gica de negocio en sistemas de bases de datos.

b. Definici√≥n o planteamiento del problema

Los sistemas modernos requieren consistencia, eficiencia y seguridad en el manejo de datos. En particular, un Servicio T√©cnico Inform√°tico involucra procesos repetitivos como:

Registrar ingresos de equipos.

Crear diagn√≥sticos y reparaciones.

Asociar repuestos.

Emitir facturas.

Registrar pagos.

Sin procedimientos y funciones, estas tareas se realizan de forma manual o mediante consultas repetidas, generando errores, p√©rdida de tiempo y falta de integridad.

Surgen entonces las preguntas centrales:

¬øQu√© diferencias existen entre un procedimiento y una funci√≥n?

¬øQu√© aporta cada uno al sistema?

¬øC√≥mo aplicarlos dentro del Servicio T√©cnico Inform√°tico para agilizar tareas esenciales?

c. Objetivo del Trabajo Pr√°ctico

Analizar y aplicar el uso de procedimientos y funciones en SQL Server, demostrando c√≥mo estos optimizan los procesos operativos del sistema de Servicio T√©cnico Inform√°tico.

i. Objetivo general

Comprender el funcionamiento, utilidad y aplicaci√≥n pr√°ctica de procedimientos y funciones almacenadas, integr√°ndolas en tareas reales del sistema de Servicio T√©cnico Inform√°tico.

ii. Objetivos espec√≠ficos

Explicar el funcionamiento de procedimientos almacenados y funciones.

Comparar ambos objetos seg√∫n sus caracter√≠sticas t√©cnicas.

Aplicar estos objetos al sistema de Servicio T√©cnico Inform√°tico.

Dise√±ar procedimientos para automatizar tareas del negocio.

Crear funciones para obtener c√°lculos y consultas frecuentes.

Evaluar c√≥mo estos objetos mejoran rendimiento, control y seguridad.

CAP√çTULO II: MARCO CONCEPTUAL O REFERENCIAL

Los procedimientos almacenados y funciones son bloques programables en SQL Server que extienden la capacidad de la base de datos.

Procedimientos Almacenados

Son conjuntos de instrucciones SQL precompilados que permiten:

Realizar operaciones DML (INSERT, UPDATE, DELETE).

Ejecutar transacciones completas.

Controlar errores mediante TRY‚Ä¶CATCH.

Encapsular l√≥gica compleja.

En un Servicio T√©cnico Inform√°tico permiten automatizar procesos como:

Registrar el ingreso de un equipo.

Finalizar una reparaci√≥n.

Actualizar stock.

Generar facturas y pagos.

Funciones Definidas por el Usuario (UDF)

Devuelven un √∫nico valor (funciones escalares) o una tabla (table-valued). No permiten modificar datos y se pueden usar directamente dentro de:

SELECT

WHERE

JOIN

Son ideales para:

C√°lculos determin√≠sticos.

Filtros reutilizables.

Consultas derivadas.

Aplicaciones en el Servicio T√©cnico:

Total gastado por cliente.

Repuestos utilizados en una reparaci√≥n.

Reparaciones por estado.

C√°lculo del costo total acumulado.

Diferencias clave
Caracter√≠stica	Procedimiento	Funci√≥n
Retorno	Cero o varios	Un valor/tabla
Uso en SELECT	‚ùå No	‚úîÔ∏è S√≠
Modificaci√≥n de datos	‚úîÔ∏è S√≠	‚ùå No
Manejo de transacciones	‚úîÔ∏è S√≠	‚ùå No
Uso recomendado	Procesos complejos	C√°lculos puros
CAP√çTULO III: METODOLOG√çA SEGUIDA
a. Descripci√≥n de c√≥mo se realiz√≥ el Trabajo Pr√°ctico

Se realiz√≥ una investigaci√≥n basada en:

Documentaci√≥n oficial de Microsoft.

Libros acad√©micos especializados.

An√°lisis del sistema real de Servicio T√©cnico Inform√°tico.

Pruebas ejecutadas en SQL Server Management Studio.

b. Herramientas utilizadas

SQL Server Management Studio (SSMS)

Microsoft Docs

Sistema de Servicio T√©cnico Inform√°tico (base de datos proporcionada)

Modelos de base de datos relacionales

CAP√çTULO IV: DESARROLLO DEL TEMA / PRESENTACI√ìN DE RESULTADOS

Aqu√≠ se presentan los conceptos aplicados al sistema real y los scripts desarrollados.

# Ejemplos Aplicados al Servicio T√©cnico Inform√°tico
## üîß PROCEDIMIENTO 1 ‚Äî Registrar Ingreso de Equipo

Este procedimiento automatiza el registro de ingresos en la tabla ingreso_equipo.

CREATE PROCEDURE RegistrarIngresoEquipo
    @id_cliente INT,
    @id_equipo INT,
    @falla VARCHAR(255)
AS
BEGIN
    DECLARE @nuevoIngresoID INT;

    SELECT @nuevoIngresoID = ISNULL(MAX(id_ingreso_equipo), 0) + 1
    FROM ingreso_equipo
    WHERE id_cliente = @id_cliente AND id_equipo = @id_equipo;

    INSERT INTO ingreso_equipo (id_ingreso_equipo, falla, id_cliente, id_equipo)
    VALUES (@nuevoIngresoID, @falla, @id_cliente, @id_equipo);

    SELECT 'Ingreso registrado correctamente' AS Resultado;
END;
GO

## üîß PROCEDIMIENTO 2 ‚Äî Finalizar Reparaci√≥n, Facturar y Registrar Pago

Encapsula 3 procesos:
‚úî Finalizaci√≥n de reparaci√≥n
‚úî Generaci√≥n de factura
‚úî Registro del pago

CREATE PROCEDURE FinalizarReparacion
    @id_reparacion INT,
    @monto DECIMAL(10,2),
    @id_medio_pago INT
AS
BEGIN
    BEGIN TRY
        BEGIN TRANSACTION;

        UPDATE reparacion
        SET fecha_resolucion = GETDATE(),
            monto_total = @monto,
            id_estado_reparacion = 3
        WHERE id_reparacion = @id_reparacion;

        DECLARE @cliente INT;

        SELECT @cliente = c.id_cliente
        FROM reparacion r
        JOIN diagnostico d ON r.id_diagnostico = d.id_diagnostico
        JOIN equipo e ON d.id_equipo = e.id_equipo
        JOIN cliente c ON c.id_cliente = e.id_cliente
        WHERE r.id_reparacion = @id_reparacion;

        INSERT INTO factura (id_cliente) VALUES (@cliente);

        DECLARE @facturaID INT = SCOPE_IDENTITY();

        INSERT INTO pago (id_medio_de_pago, id_factura, monto, id_reparacion)
        VALUES (@id_medio_pago, @facturaID, @monto, @id_reparacion);

        COMMIT;
        SELECT 'Reparaci√≥n finalizada y factura generada' AS Resultado;

    END TRY
    BEGIN CATCH
        ROLLBACK;
        THROW;
    END CATCH
END;
GO

# üîß FUNCIONES APLICADAS AL SISTEMA
## üìò FUNCI√ìN 1 ‚Äî Total Gastado por un Cliente
CREATE FUNCTION fn_TotalGastadoCliente(@id_cliente INT)
RETURNS DECIMAL(10,2)
AS
BEGIN
    RETURN (
        SELECT ISNULL(SUM(p.monto),0)
        FROM pago p
        JOIN factura f ON f.id_factura = p.id_factura
        WHERE f.id_cliente = @id_cliente
    );
END;
GO

## üìò FUNCI√ìN 2 ‚Äî Reparaciones por Estado
CREATE FUNCTION fn_ReparacionesPorEstado(@id_estado INT)
RETURNS TABLE
AS
RETURN
(
    SELECT r.id_reparacion, r.fecha_resolucion, r.monto_total
    FROM reparacion r
    WHERE r.id_estado_reparacion = @id_estado
);
GO

CAP√çTULO V: CONCLUSIONES

Los procedimientos y funciones almacenadas demostraron ser herramientas clave para mejorar la eficiencia, seguridad y mantenibilidad del sistema de Servicio T√©cnico Inform√°tico.

Los procedimientos permitieron automatizar tareas cr√≠ticas como registrar ingresos, finalizar reparaciones y generar facturas. Las funciones, por su parte, ofrecen c√°lculos reutilizables y consultas consistentes, √∫tiles para an√°lisis y reportes.

Ambos objetos, utilizados en conjunto, fortalecen la estructura l√≥gica del sistema y permiten escalarlo de manera segura y ordenada.

VI. BIBLIOGRAF√çA

Microsoft Docs: CREATE PROCEDURE (Transact-SQL)

Microsoft Docs: CREATE FUNCTION (Transact-SQL)

SQLShack (Calbimonte, 2019)

Coronel, C. ‚Äî Database Systems: Design, Implementation, and Management

Elmasri & Navathe ‚Äî Fundamentals of Database Systems
